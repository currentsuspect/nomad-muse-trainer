# nomad-muse-trainer configuration

# Tokenization
tokenization:
  time_shift_bins: 32  # Number of discrete time shift bins (e.g., 20ms each)
  time_shift_ms: 20    # Milliseconds per time shift unit
  velocity_bins: 8     # Quantize MIDI velocity (0-127) into this many bins
  duration_bins: 16    # Quantize note duration into this many bins
  max_duration_ms: 2000  # Max duration to consider (ms)

# Data preparation
data:
  sequence_length: 512  # Tokens per training sequence
  min_midi_length: 32   # Minimum tokens to include a MIDI file
  max_midi_length: 16384  # Maximum tokens per MIDI (truncate longer files)
  melody_only: false    # If true, only use track 0
  train_split: 0.8
  val_split: 0.1
  test_split: 0.1
  seed: 42

# Training
training:
  batch_size: 12  # CPU-optimized for 4-core/16GB (was 32)
  epochs: 50
  learning_rate: 0.001
  weight_decay: 0.0001
  grad_clip: 1.0
  early_stop_patience: 5
  checkpoint_dir: "artifacts/checkpoints"
  device: "cuda"  # "cuda" or "cpu"
  num_workers: 2  # CPU-optimized for 4-core (was 4)

# Model architectures
models:
  gru:
    hidden_size: 128
    num_layers: 2
    dropout: 0.2
  
  transformer:
    d_model: 256
    nhead: 2
    num_layers: 2
    dim_feedforward: 512
    dropout: 0.2

# Baseline
baseline:
  markov_order: 4
  interval_bins: 25  # -12 to +12 semitones
  smoothing: "witten-bell"

# Export
export:
  onnx_opset: 17
  quantization: "dynamic"  # "dynamic" or "static"

# Evaluation
evaluation:
  top_k_values: [1, 3, 5, 10]
  sample_length: 256  # Tokens to generate for demo
  sample_temperature: 1.0
  sample_primer_length: 16
